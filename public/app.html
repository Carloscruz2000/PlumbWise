<script>
  // ...keep all your existing code above...

  /* ---------------- Boot ---------------- */
  window.addEventListener('DOMContentLoaded', async () => {
    // 1) Show whatever we have locally
    reflectAccessUI();

    // 2) If we just returned from Stripe, confirm using session_id and persist
    await confirmFromSessionId();

    // 3) On every load, if we have an email saved, verify with the server.
    //    This keeps access if the browser cleared localStorage or you switch devices.
    const email = savedEmail();
    if (email) {
      try {
        const res = await fetch("/api/subscription-status", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email })
        });
        const data = await res.json();
        setActive(email, !!data.active);
      } catch {
        // If the network is offline, keep whatever local state we had
      }
    }

    // 4) Render the UI cards
    home();
  });
</script>
